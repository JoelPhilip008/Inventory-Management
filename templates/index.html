<!-- templates/index.html -->

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Inventory Management</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

  <span class="menu-icon" onclick="toggleSectionNav()">&#9776;</span>

  <div id="sectionOffcanvas" class="push-sidebar" style="background: rgba(0, 0, 0, 0.7)">
  <!-- <a href="javascript:void(0)" class="closebtn" onclick="closeSectionNav()">&times;</a> -->
  <!-- Add closeSectionNav() to each link's onclick -->
  <a href="javascript:void(0)" onclick="filterBySection(''); closeSectionNav();">All Sections</a>
  {% for section in all_sections %}
    <a href="javascript:void(0)" onclick="filterBySection('{{ section }}'); closeSectionNav();">{{ section }}</a>
  {% endfor %}
</div>

  <header class="main-header py-3 border-bottom container-fluid">
    <div class="d-flex flex-wrap justify-content-between align-items-center container">
      <a href="/" class="d-flex align-items-center text-dark text-decoration-none">
        <span class="fs-4 fw-bold" style="padding-left: 40px; color: whitesmoke;">Inventory System</span>
      </a>
      <ul class="nav nav-pills align-items-center">
        {% if session.role == 'admin' %}
        <li class="nav-item"><a href="{{ url_for('view_logs') }}" class="nav-link">View Logs</a></li>
        {% endif %}
        <li class="nav-item"><span class="nav-link fw-medium" style="color: azure;">Hello, {{ session.username }}!</span></li>
        <li class="nav-item ms-2"><a href="{{ url_for('logout') }}" class="btn btn-outline-danger btn-sm">Logout</a></li>
      </ul>
    </div>
  </header>

  <div id="mainContent">

    <div class="container-fluid px-4">
      <div class="ui-card">
        <div class="controls d-flex flex-wrap align-items-center gap-3">
          <div class="flex-grow-1">
              <input id="search" class="form-control form-control-lg" type="text" placeholder="Search components, specs, SKU..." />
          </div>
          <div class="vr mx-2 d-none d-md-block"></div>
          <a href="{{ url_for('transaction_page') }}" class="btn btn-success btn-lg fw-bold text-white" style="min-width: 140px;">Retrieve / Return</a>
          <button id="advancedToggleBtn" class="btn btn-secondary" onclick="toggleAdvancedColumns()">Show Advanced</button>
          {% if session.role == 'admin' %}
          <a href="{{ url_for('edit_page') }}" class="btn btn-primary btn-lg fw-bold">Add New Item</a>
          <a href="/download" class="btn ms-auto d-flex gap-2" style="background-color: rgba(255, 255, 255, 0.3);">Download Backup</a>
          {% endif %}
        </div>
      </div>

      <div class="ui-card p-0 overflow-hidden">
        <div class="table-responsive">
          <table id="inv-table" class="table table-striped table-hover mb-0">
            <thead class="table-light">
              <tr id="table-headers">
                {% for h in headers %}
                  <th class="{{ 'advanced-column' if h in ['Part number', 'SKU ID', 'Remarks', 'URLS'] else '' }}" data-header-name="{{ h }}">{{ h }}</th>
                {% endfor %}
                {% if session.role == 'admin' %}
                <th data-header-name="Actions">Actions</th>
                {% endif %}
              </tr>
            </thead>
            <tbody id="table-body" class="table-group-divider">
              {% for row in data %}
                <tr data-item-no="{{ row[0] }}">
                  {% for cell_value in row %}
                    <td class="{{ 'advanced-column' if headers[loop.index0] in ['Part number', 'SKU ID', 'Remarks', 'URLS'] else '' }}" data-col-name="{{ headers[loop.index0] }}">
                      {% if headers[loop.index0] == 'URLS' and cell_value %}
                        <a href="{{ cell_value }}" target="_blank" class="text-decoration-none fw-bold">Link &nearr;</a>
                      {% else %}
                        {{ cell_value }}
                      {% endif %}
                    </td>
                  {% endfor %}
                  {% if session.role == 'admin' %}
                  <td>
                    <div class="d-flex gap-1">
                      <a href="{{ url_for('edit_page', item_no=row[0]) }}" class="btn btn-sm btn-outline-primary fw-bold" title="Edit">Edit</a>
                      <a href="#" onclick="adjust(event, {{ row[0] }}, 1)" class="btn btn-sm btn-outline-success fw-bold" title="Add 1">+1</a>
                      <a href="#" onclick="adjust(event, {{ row[0] }}, -1)" class="btn btn-sm btn-outline-warning fw-bold text-dark" title="Remove 1">-1</a>
                      <a href="#" onclick="deleteItem(event, {{ row[0] }})" class="btn btn-sm btn-outline-danger ms-1" title="Delete Item">&times;</a>
                    </div>
                  </td>
                  {% endif %}
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div> 
  </div> 

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>

<!-- end of file -->